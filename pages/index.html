---
permalink: /
layout: default
---

<style>
	.fake-a {
		cursor: pointer;
	}
</style>

<div id="app">
	<button class="mobile-nav">&#x2630;</button>

	<div id="side-menu">
		<ul class="category">
			<li><a style="font-weight:500;" href="">SHOW ALL</a></li>
			
			<br><br>
			
			<li><a style="font-weight:500;" href="">RANDOM</a></li>
			
			<br><br>
			
			<li style="color:hsl(192, 96%, 45%); font-weight:500;  padding-bottom:0.25em;">FILTER BY LEVEL</li>	
			<li style="	font-weight:500;"><a href="">Professional Creatives</a></li>	
			<li style="	font-weight:500;"><a href="">Students</a></li>	
			<li style="	font-weight:500;"><a href="">Hobbyists</a></li>
			
			<br><br>
			
			<li style="color:hsl(192, 96%, 45%); font-weight:500; padding-bottom:0.25em;">FILTER BY PROFESSION</li>	
			<li v-for="category in categories">
				<a @click="loadTweetsFromCategory(category)" class="fake-a">
					<% category %>
				</a>
			</li>
			
			<br><br><br>
			
			<li style="	font-weight:500;"><a href="{{ site.baseurl }}/about">ABOUT</a></li>
		</ul>
		
	</div>
			
	<div id="main-content">
		<a href="{{ site.baseurl }}/"><img class="peeps-lettering" src="{{ site.baseurl }}/res/img/visiblepeeps.png"></a>

		 	<h2>Women, non-binary and trans creators on Twitter<br> <a href="https://twitter.com/hashtag/VisibleWomen?src=hash">#VisibleWomen</a> Â· <a href="https://twitter.com/hashtag/VisibleNB?src=hash">#VisibleNB</a></h2>
		
		<div>
			<a href="{{site.baseurl}}/submit" class="submit-button">SUBMIT TWEET</a>
		</div>
	
		<div class="module-grid" ref="tweetContainer"></div>
		
		<div v-if="!finishedLoading">
			<br><br><br>
			Loading...
			<br><br><br>
		</div>
	</div>
</div>

<script>
	window.onload = function(){
		// Add shuffle functionality to arrays.
		// This allows us to randomize the tweets on the page.
		Array.prototype.shuffle = function(){
			let out = [];
			let clone = this.slice();
			
			while (clone.length > 0){
				let index = Math.floor(Math.random() * clone.length);
				let item = clone.splice(index, 1)[0];
				out.push(item);
			}
			
			return out;
		};
		
		// Initialize the Firebase app settings.
		firebase.initializeApp({
			apiKey: "AIzaSyDahkALUP2HDnuLqiXOt-ScOPobhqFoW84",
			authDomain: "visiblewomen-net.firebaseapp.com",
			databaseURL: "https://visiblewomen-net.firebaseio.com",
			projectId: "visiblewomen-net",
			storageBucket: "visiblewomen-net.appspot.com",
			messagingSenderId: "532732660193"
		});
		
		// Create the Vue app.
		let app = new Vue({
			// Use the #app element.
			el: "#app",
			
			// These are necessary to avoid compilation problems
			// with Jekyll, which uses "{{" and "}}" delimiters.
			delimiters: ["<%", "%>"],
			
			data: {
				finishedLoading: true,
				categories: [],
				currentCategory: "ALL",
				lastUserUID: "-1",
			},
			
			methods: {
				loadTweetsFromCategory: function(category, shouldKeepCurrentTweets){
					let self = this;
					self.currentCategory = category;
					
					if (!shouldKeepCurrentTweets) self.$refs.tweetContainer.innerHTML = "";
					
					let db = firebase.database();
					let ref = db.ref("/tweets/" + category).orderByKey().startAt(self.lastUserUID + "0").limitToFirst(10);
					
					ref.once("value").then(function(snapshot){
						let userUIDs = snapshot.val();
						if (!userUIDs) return;
						
						let uids = Object.keys(userUIDs);
						self.lastUserUID = uids[uids.length-1];
						
						uids.forEach(function(uid){
							let ref2 = db.ref("/allUsers/" + uid);
							
							ref2.once("value").then(function(snapshot2){
								let userData = snapshot2.val();
								if (!userData || !userData.profileTweet) return;
								
								// Create a blockquote element of class "twitter-tweet".
								let blockquote = document.createElement("blockquote");
								blockquote.className += "twitter-tweet";
								
								// Create an anchor element with the tweet's url as its href.
								let a = document.createElement("a");
								a.href = userData.profileTweet;
								
								// Create a script element with the Twitter widgets JS file
								// as its source.
								let script = document.createElement("script");
								script.src = "https://platform.twitter.com/widgets.js";
								
								// Put the anchor element inside the blockquote element.
								blockquote.appendChild(a);
								
								// Put the blockquote and the script inside the tweetContainer
								// element, which is referenced up in the HTML.
								self.$refs.tweetContainer.appendChild(blockquote);
								self.$refs.tweetContainer.appendChild(script);
							});
						});
					});
				},
			},
			
			mounted: function(){
				let self = this;
				let db = firebase.database();
				
				let ref1 = db.ref("/categoryList");
				
				ref1.once("value").then(function(snapshot){
					self.categories = [];
					let categories = snapshot.val();
					if (!categories) return;
					self.categories = Object.keys(categories);
					
					self.loadTweetsFromCategory("ALL");
				});
				
				window.addEventListener("scroll", function(event){
					var h = document.documentElement, 
					b = document.body,
					st = 'scrollTop',
					sh = 'scrollHeight';

					var percent = (h[st]||b[st]) / ((h[sh]||b[sh]) - h.clientHeight);
				
					if (percent > 0.8){
						console.log("loading more...");
						self.loadTweetsFromCategory(self.currentCategory, true);
					}
				});
			},
		});
		
		// The Vue app element is originally hidden so as not to display the
		// strange markup. We unhide it once Vue has mounted the app.
		document.getElementById("app").style.display = "block";
	};
</script>
