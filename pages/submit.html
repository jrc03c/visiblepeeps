---
permalink: /submit
layout: default
---

<button class="mobile-nav">&#x2630;</button>

<div id="side-menu">
	<ul class="category">
		<li><a style="font-weight:500;" href="">SHOW ALL</a></li>
		
		<br><br>
		
		<li><a style="font-weight:500;" href="">RANDOM</a></li>
		
		<br><br>
		
		<li style="color:rgb(29,161,242); font-weight:500;  padding-bottom:0.25em;">FILTER BY LEVEL</li>	
		<li style="	font-weight:500;"><a href="">Professional Creatives</a></li>	
		<li style="	font-weight:500;"><a href="">Students</a></li>	
		<li style="	font-weight:500;"><a href="">Hobbyists</a></li>
		
		<br><br>
		
		<li style="color:rgb(29,161,242); font-weight:500; padding-bottom:0.25em;">FILTER BY PROFESSION</li>		
		<li><a href="">Fine Artists</a></li>			
		<li><a href="">Illustrators</a></li>			
		<li><a href="">Concept Artists</a></li>			
		<li><a href="">3D Artists</a></li>			
		<li><a href="">Photographers</a></li>			
		<li><a href="">Designers</a></li>			
		<li><a href="">Comics Artists</a></li>			
		<li><a href="">Cartoonists</a></li>			
		<li><a href="">Animators</a></li>			
		<li><a href="">Storyboard Artists</a></li>
		<li><a href="">Vis Dev Artists</a></li>
		<li><a href="">Background Artists</a></li>
		<li><a href="">Film Makers</a></li>
		<li><a href="">Character Designers</a></li>
		<li><a href="">3D Environment Artists</a></li>
		<li><a href="">3D Character Artists</a></li>
		<li><a href="">Game Artists</a></li>
		<li><a href="">Crafts Artists</a></li>
		
		<br><br>
		
		<li style="	font-weight:500;"><a href="{{ site.baseurl }}/about">ABOUT</a></li>

		<br><br>
		
		<li style="	font-weight:500;"><a href="">PROFILE</a></li>
		<li><a style=" color:rgb(29,161,242); font-weight:500;" href="">LOGIN/OUT</a></li>
	</ul>
	
</div>

<div id="main-content">
	


		<a href="{{ site.baseurl }}/"><img class="peeps-lettering" src="{{ site.baseurl }}/res/img/visiblepeeps.png"></a>

			<h2>Women, non-binary and trans creators on Twitter<br> <a href="https://twitter.com/hashtag/VisibleWomen?src=hash">#VisibleWomen</a> Â· <a href="https://twitter.com/hashtag/VisibleNB?src=hash">#VisibleNB</a></h2>

	<div class="submit-page">

		<div id="app">
			<div v-if="isLoggedIn">

				<p>Hi! If you'd like to update your tweet, just change the URL in the input field, or change any of the categories you have previously selected, and hit submit! Anything you want :D</p>

				<br><br>


				<form @submit.prevent="save">
					<p v-if="message.length > 0">
						<% message %>
					</p>

					<label style="font-weight:500;" for="tweet-url">
						Tweet URL
					</label>
					<p>Copy / paste the URL to your tweet here.</p>	
					
					<input type="text" v-model="url" id="tweet-url" @keydown="message = ''">

					<br><br><br><br>

					<p style="font-weight:500;">Choose what level represents you</p>

					<br>

					<select name="level">

						<option value="Professional Creatives">Professional Creative</option>
						<option value="Students">Student</option>
						<option value="Hobbyists">Hobbyist</option>

					</select>

					<br><br><br><br>

					<p style="font-weight:500;">Choose the profession that best describes you  (Select up to 3)</p>
					<p style="font-style:italic; color:rgb(150,150,150);">Hold ctrl / cmd to select multiple</p>

					<br>
					
					<div v-for="category in categories" class="profession">
<!-- 						<input type="checkbox" v-model="category.value" :id="category.name">
						
						<label :for="category.name">
							<% category.name %>
						</label> -->


						<select name="profession" id="profession" multiple="multiple" size="18" :id="category.name">

							<option v-model="category.value" :for="category.name"><% category.name %></option>

						</select>

					</div>

					<br><br><br><br>

					<input type="submit" value="Save">

				</form>
				
				<button @click="logout">Log out</button>
			</div>

			<div v-else>
				<p>
					This page will act as your profile when you log in with your Twitter account. Once you have made a submission and been approved, you'll be able to log in, update your submitted tweet, and any categories you have picked.
				</p>	
					<br><br>			

				<p>
					Please log in with your Twitter account to create a profile page.
				</p>

				<button @click="login">Log in</button>
			</div>
		</div>

	</div>

</div>

<script>
	window.onload = function(){
		// Initialize the Firebase app settings.
		firebase.initializeApp({
			apiKey: "AIzaSyDahkALUP2HDnuLqiXOt-ScOPobhqFoW84",
			authDomain: "visiblewomen-net.firebaseapp.com",
			databaseURL: "https://visiblewomen-net.firebaseio.com",
			projectId: "visiblewomen-net",
			storageBucket: "visiblewomen-net.appspot.com",
			messagingSenderId: "532732660193"
		});
		
		// Create the view app.
		let app = new Vue({
			// Use the #app element.
			el: "#app",
			
			// These are necessary to avoid compilation problems
			// with Jekyll, which uses "{{" and "}}" delimiters.
			delimiters: ["<%", "%>"],
			
			// The url variable keeps track of what the user types
			// into the text input field. The isLoggedIn makes it
			// so that only logged-in users can see the submission form.
			// The canSubmit variable helps to prevent spamming of 
			// the form; we use a 5-second timeout between submissions,
			// during which the canSubmit variable is set to false.
			// The message variable shows a message to the user if
			// something is wrong with the submission (like if their
			// url doesn't come from twitter.com, or if it doesn't contain
			// "status", or if they don't wait long enough between 
			// submissions). We also download the tweetsToApprove and 
			// the approvedTweets to make sure that we don't let the user
			// add duplicates. And finally, we download the user's data
			// so that we can attach their username to the tweet they
			// submit, which makes it easy for us to block them later
			// if we don't like the submissions they're making.
			data: {
				isLoggedIn: false,
				canSubmit: true,
				message: "",
				user: null,
				categories: [],
				url: "",
			},
			
			methods: {
				// This is the typical Firebase / Twitter auth flow.
				login: function(){
					let provider = new firebase.auth.TwitterAuthProvider();
					
					firebase.auth().signInWithPopup(provider).then(function(result){
						let db = firebase.database();
						
						// We make sure that we grab the user's Twitter username.
						// For some stupid reason, this is the only time that
						// this information is available to us.
						let username = result.additionalUserInfo.username;
						
						// We store the username in the database under their 
						// Firebase auth UID.
						let ref = db.ref("/allUsers/" + result.user.uid + "/username");
						ref.set(username);
					}).catch(function(error){
						console.error(error);
					});
				},
				
				// This the typical Firebase sign-out method, though
				// this is where we also stop listening to the database
				// references.
				logout: function(){
					firebase.auth().signOut();
				},
				
				// This is where we do all the submission magic.
				save: function(){
					let self = this;
					
					// Try to make a URL object out of the user's submission.
					let urlObj;
					
					try {
						urlObj = new URL(self.url);
					} catch (error){
						// If it fails, then it's probably because they didn't enter
						// a valid URL. Let them know about it and then return.
						self.message = "It doesn't look like you entered a valid URL. Please enter a URL that points directly to a tweet.";
						return;
					}
					
					// If the user's submission doesn't come from twitter.com or doesn't
					// include "status", then let them know about it and then return.
					if (urlObj.hostname !== "twitter.com" || !urlObj.pathname.includes("status")){
						self.message = "There was a problem with the URL you provided. Please enter a URL that points directly to a tweet.";
						return;
					}

					let db = firebase.database();					
					let categories = {};
					let hasAtLeastOneCategory = false;
					
					self.categories.forEach(function(category){
						let ref = db.ref("/tweets/" + category.name + "/" + self.user.uid);
						
						if (category.value === true){
							categories[category.name] = true;
							ref.set(true);
							hasAtLeastOneCategory = true;
						} else {
							ref.set(null);
						}
					});
					
					if (hasAtLeastOneCategory){
						db.ref("/tweets/ALL/" + self.user.uid).set(true);
					} else {
						db.ref("/tweets/ALL/" + self.user.uid).set(null);
					}
					
					let ref = db.ref("/allUsers/" + self.user.uid);
					
					ref.set({
						username: self.user.username,
						profileTweet: "https://twitter.com" + urlObj.pathname,
						categories,
					}).then(function(){
						self.message = "Saved!";
						
						setTimeout(function(){
							self.message = "";
						}, 3000);
					}).catch(function(error){
						self.message = "There was an error saving your profile information. :(";
					});
				},
			},
			
			mounted: function(){
				let self = this;
				
				// We listen to a bunch of database references. I'm not sure
				// whether this is optimal or not, but it is what it is. :) 
				// Anyway, I'm making references to them here so that I can 
				// turn them off when the user logs out.
				let ref1, ref2;
				
				// Listen for users logging in and out, and then...
				firebase.auth().onAuthStateChanged(function(user){
					// Unhide the #app element, which was hidden so as not
					// to show off its weird markup.
					document.getElementById("app").style.display = "block";
					
					// Set the isLoggedIn variable.
					self.isLoggedIn = !!user;
					
					// turn off listeners
					if (ref1) ref1.off();
					if (ref2) ref2.off();
					
					// If the user is logged in, then...
					if (user){
						let db = firebase.database();
						
						// Get a reference to the user's data in the database.
						ref1 = db.ref("/allUsers/" + user.uid);
						
						// Listen to that reference, in case the user suddenly
						// gets blocked or their data changes in some other way.
						ref1.on("value", function(snapshot){
							// Get their data.
							let userData = snapshot.val();
							
							// If for some reason the data doesn't exist,
							// then return.
							if (!userData) return;
							
							// Set their info into the user variable.
							self.user = userData;
							self.user.uid = user.uid;
							
							self.url = self.user.profileTweet || "";
							
							if (ref2) ref2.off();
							
							ref2 = db.ref("/categoryList");
							
							ref2.on("value", function(snapshot){
								self.categories = [];
								
								let categories = snapshot.val();
								if (!categories) return;
								
								Object.keys(categories).forEach(function(category){
									self.categories.push({
										name: category,
										value: self.user.categories && self.user.categories[category],
									});
								});
							});
						});
					}
				});
			},
		});
	};
</script>
